<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Assistant Questions</title><link rel="icon" href="https://xenius.in/wp-content/uploads/2017/06/favicon.png" type="image/icon type"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet"href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
<script src ="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.3/js/dataTables.buttons.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css"/>
    <script>
       
        function rendertable(){
            url = "http://localhost:7004/getDt";
            console.log(url)

            let xhr = new XMLHttpRequest();
            xhr.open('GET', url, true);
            
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.send();
            xhr.addEventListener("readystatechange", processRequest, false);

            function processRequest(e) {
                var style = document.createElement('style');
                if (xhr.readyState == 4 && xhr.status == 200) {
                    let response = JSON.parse(xhr.responseText);
                    // obis_data=JSON.stringify(response)
                    console.log(response)
                    console.log("here are your mainkeys"+response.answerData.main_key)
                    console.log(response.questionData)

                    console.log(response.answerData)
                    console.log(response.questionData.length)
                    var list_mainkey = [];
                    var list="";
                    $.each(response.questionData, function (index) {
                        list_mainkey.push(response.questionData[index].main_key) ;
                        list += "<tr>";
                        list += "<td id='quesbtn"+response.questionData[index].ques_id+"'>" + response.questionData[index].ques_id + "</td>";
                        list += "<td>" + response.questionData[index].text + "</td>";
                        list += "<td  class='input_wrapper' ><input id='ansbtn"+response.questionData[index].ques_id+"' type='number' value='"+response.questionData[index].ans_id+"'> </td>";
                        list += "<td>" + response.questionData[index].status + "</td>";
                        list += "<td id='mainkeybtn"+response.questionData[index].ques_id+"'>" + response.questionData[index].main_key + "</td>";
                        list += "<td><button id='btn"+response.questionData[index].ques_id+"'  onclick='Set_answer(this)' class='btn btn-primary'>Set Answer</button></td>";
                        list += "</tr>";
                    })
// var a =" /''+response.questionData[index].ques_id+/'' "
                   
                    $("#questiontable").append(list);
                    
                        // console.log("length of ans table"+response.answerData.length+1)
                        var y=response.answerData.length+1 ;
                       
                    // answertable(response.answerData)
                    list="";
                    list += "<tr>";
                   list += "<td><input id='new_id' type='number'value='"+y+"' ></td>";
                   list += "<td><input id='new_func' type='number' ></td>";
                   list += "<td><input id='new_url' type='url' ></td>";
                   list += "<td><select id='new_mainkey'>"
                   list_mainkey.forEach(function (item) {
                    // console.log(item, index);
                  
                   list +="<option value='"+item+"'>"+item+"</option>"
                    
                    
                    
                         });
                    list +=  "</select></td>"
                   list += "<td><input id='new_ans' type='text' ></td>";
                //    list += "<td><button onclick='add_answer()' class='btn btn-primary'>Add Answer</button></td>"
                   list += "</tr>";
                   $("#answertable").append(list);
                   var list1="";
                   console.log("hi");

                    $.each(response.answerData, function (index) {
                       console.log("hello")
                       list1 += "<tr>";
                       list1 += "<td>" + response.answerData[index].ans_id + "</td>";
                       list1 += "<td>" + response.answerData[index].function + "</td>";
                       list1 += "<td>" + response.answerData[index].api_url + "</td>";
                       list1 += "<td>" + response.answerData[index].main_key + "</td>";
                       list1 += "<td>" + response.answerData[index].answer + "</td>";
                       list1 += "</tr>";
                   })
                   console.log("hihi") ;
                  
                   $("#answertable").append(list1);
                   $(document).ready(function () {
    var table = $('#questiontable').DataTable({
        // "bDestroy": true,
        // "aaData": response.questionData,
        // "rowReorder": true,
        // "aoColumns": [{
        //                  "mDataProp": "ques_id"
        //              }, {
        //                  "mDataProp": "text"
        //              }, {
        //                  "mDataProp": "ans_id"
        //              } ],
        pageLength: 5,
        
        lengthMenu: [ 5, 10, 15, 20,30,40 , 50],
        columnDefs: [
            {  
               
                orderable: false,
                targets: [1, 2, 3],
            },
        ],
    });
 
    // $('button').click(function () {
    //     var data = table.$('input, select').serialize();
    //     alert('The following data would have been submitted to the server: \n\n' + data.substr(0, 120) + '...');
    //     return false;
    // });
});
            $(document).ready(function () {
                var table = $('#answertable').DataTable({
                    dom: 'Bfrtip',
                    pageLength: 5,
                    
                lengthMenu: [ 5, 10, 15, 20,30,40 , 50],
                    columnDefs: [
                        {  
                        
                            orderable: false,
                            targets: [1, 2, 3],
                        },
                    ],
                    buttons: [
                         {
                text: 'Add Answer',
                action: function ( e, dt, node, config ) {

                
                    console.log("updating answers")
	var d = document.getElementById("new_mainkey").value;
	var e = document.getElementById("new_ans").value;
	var a = document.getElementById("new_id").value;
	var b = document.getElementById("new_func").value;
	var c = document.getElementById("new_url").value;
	
	console.log(e)
	console.log(c)
	
	 var raw = JSON.stringify({
		   "ans_id": a,
		   "function": b,
		   "api_url" : c ,
		   "main_key" : d,
		   "answer" : e , 
		   
		 });
	 
	
	
	console.log(e)
	console.log(c)
	console.log(raw)
	var myHeaders = new Headers();
	 myHeaders.append("Content-Type", "application/json");

	

	 var requestOptions = {
	   method: 'POST',
	   headers: myHeaders,
	   body: raw,
	   redirect: 'follow'
	 };

	 fetch("http://localhost:7004/addAns", requestOptions)
	   .then(response => response.text())
	   
	   .then(result => alert(result))
	   .catch(error => console.log('error', error));
	
	location.reload()

                }
            }
        ]
                });
            });

                    if (response.Status !== 'Success') {
                        alert(response.MESSAGE)
                        console.log('Error')
                        console.log(response.DATA)
                        
                        
                        return;
                    }
                }
            }
        }
       
        function Answertb() {
            
         
            
            var a =document.getElementById("ans_tab") ; 
                    a.style.zIndex="2" ;
            if (a.style.display === "none") {

                a.style.display = "block";
            } else {
                    a.style.display = "none";
                }


            
        }
    
        function show() {
            var rowId = event.target.parentNode.parentNode.id;
            console.log(rowId)
   
            var data = document.getElementById(rowId)
        
            console.log(data)
          
        }

        function Set_answer(element) {
            console.log(element.id)
           
          var a = document.getElementById("ques"+element.id).innerHTML ;
      
            var data = document.getElementById("ans"+element.id).value ;
            console.log(data)
            // var main_key=document.getElementById("mainkey"+element.id).innerHTML ;
        // var rowId = event.target.parentNode.parentNode.id;
        // console.log(rowId)

        var myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json");

        var raw = JSON.stringify({
        "question_id":a ,
        "Answer_id": data 
        // "main_key" :main_key
        });

        var requestOptions = {
        method: 'POST',
        headers: myHeaders,
        body: raw,
        redirect: 'follow'
        };
        
        fetch("http://localhost:7004/setAns", requestOptions)
        .then(response => response.text())
        
        .then(result => alert(result))
        .catch(error => console.log('error', error));
	 
        }

        function add_answer() {
	console.log("updating answers")
	var d = document.getElementById("new_mainkey").value;
	var e = document.getElementById("new_ans").value;
	var a = document.getElementById("new_id").value;
	var b = document.getElementById("new_func").value;
	var c = document.getElementById("new_url").value;
	
	console.log(e)
	console.log(c)
	
	 var raw = JSON.stringify({
		   "ans_id": a,
		   "function": b,
		   "api_url" : c ,
		   "main_key" : d,
		   "answer" : e , 
		   
		 });
	 
	
	
	console.log(e)
	console.log(c)
	console.log(raw)
	var myHeaders = new Headers();
	 myHeaders.append("Content-Type", "application/json");

	

	 var requestOptions = {
	   method: 'POST',
	   headers: myHeaders,
	   body: raw,
	   redirect: 'follow'
	 };

	 fetch("http://localhost:7004/addAns", requestOptions)
	   .then(response => response.text())
	   
	   .then(result => alert(result))
	   .catch(error => console.log('error', error));
	
	location.reload()
}


// function triggerbtn(){
    
// var table = $('#answertable').DataTable();
 
// table.buttons( '.buttons-addans' ).trigger();
// }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script src='https://kit.fontawesome.com/a076d05399.js'></script>
    
   
   <style>
    
    body {background-color: #e6ecf0 ;
         
        }
    /* row {margin-top: 5px;margin-bottom: 5px;padding-top: 5px;padding-bottom: 5px;padding-left: 5px;padding-right: 5px;} */
    table.dataTable {

            box-shadow: #bbbbbb 0px 0px 5px 0px;

            }
    .container-fluid{ padding-left:1%!important; padding-right:1%!important; }
    .inputcell{
        background-color: #062941 ;
        
        color: #e6ecf0
    }
    .input_wrapper{
  position: relative;
  width: 70%;
  display: block;
}
    
    #myInput {
      
      background-position: 10px 12px; /* Position the search icon */
      background-repeat: no-repeat; /* Do not repeat the icon image */
      width: 100%; /* Full-width */
      font-size: 16px; /* Increase font-size */
      padding: 12px 20px 12px 40px; /* Add some padding */
      border: 1px solid #ddd; /* Add a grey border */
      margin-bottom: 12px; /* Add some space below the input */
    }
    </style>
    
</head>
<body onload="rendertable()">
    <nav class="navbar navbar-light border-bottom border-dark" style="background-color: #e6ecf0;">
        <img src="xenius-logo.png" width="10%" style="padding: 5px;">
        <button onclick="Answertb()" type="button" class="mr-1 ml-auto btn btn-danger">Answer Table </button>
      <a class="nav-link" class="nav-link" href="./keywords.html" target="_blank">    <button onclick="keywordtb()" type="button" class="btn btn-danger">Keywords</button></a>
        </div>
      </nav>
    <div class="mt-3 container-fluid col-sm-12">
        <!-- class="table table-hover table-condensed table-dark table-bordered" -->
        <div >
            <table id="questiontable">
                <thead><tr><th>Question_id</th><th>Question</th><th>Ans_id</th><th>Status</th><th>main_key</th><th>Set answer</th></tr>
                </thead>
                
                <tbody>
                    
                </tbody>

            </table>

            <div style="display: none;" id="ans_tab">
                <!-- <button class="addans" onclick="triggerbtn()">answer </button> -->
                <table id="answertable" >
                    
                    <thead><tr><th>Ans_id</th><th>Function</th><th>Api_url</th><th>main_key</th><th>answer</th></tr>
                    </thead>    
                    
                    <tbody>
                        
                    </tbody>
    
                </table>
    
            </div>
        </div>
        

    </div>
   
</body>
</html>